<!DOCTYPE html> 
<html>
    <title>HyeonWoo Vintage Shop </title>
    <link rel="stylesheet" href="ShoppingMall.css" type="text/css">
    <head>
        <script type="text/javascript" src="http://code.jquery.com/jquery-3.2.1.js"></script>
        <script type="text/javascript">
            
            var isLogin;
        
            function loginfunction(){
                var mem_id = $('#member_id').val(); // member_id inputField의 값을 얻어온다.
                var mem_pw = $('#member_password').val();
                
                $.post('/login', { id : mem_id, pw : mem_pw // login, id와 pw를 json 형태로 전송
                }, function (data) {
                    if(data == false) // 반환값이 없을 경우 아이디 또는 비밀번호가 틀림
                    {
                        alert("아이디 혹은 비밀번호가 잘못 되었습니다.");
                    }
                    else // 반환 값이 있을 경우 로그인 성공
                    {
                        alert("로그인 성공!");
                        isLogin = true;
                        
                        sessionStorage.clear();
                        sessionStorage.setItem('userid',data[0].ID);
                        sessionStorage.setItem('userpw',data[0].PASSWORD);
                        sessionStorage.setItem('username',data[0].NAME);
                        
                        
                        // const user = 
                        // {
                        //     user_id : data[0].ID,
                        //     user_pw : data[0].PASSWORD
                        // };
                        // sessionStorage.setItem('user',JSON.stringify(user));
                        // var id = sessionStorage.getItem('user');
                        //console.log(id);
                        

                        $('.mainPage').show();
                        $('.adminPage').hide();
                        $('.loginPage').hide();
                        $('.signupPage').hide();
                            
                    }
                    location.reload();
                });
            };

            function signupfunction(){
                var signup_mem_id = $('#signup_member_id').val(); // member_id inputField의 값을 얻어온다.
                var signup_mem_pw = $('#signup_member_pw').val();
                var signup_mem_name = $('#signup_member_name').val();
                var signup_mem_phone = $('#signup_member_phone').val()
                var signup_mem_phone1 = $('#signup_member_phone1').val()
                var signup_mem_phone2 = $('#signup_member_phone2').val()

                var pattern_kor = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/;
                var pattern_num = /[0-9]/;
                var pattern_spc = /[~!@#$%^&*()_+|<>?:{}]/;

                if(!signup_mem_id)
                {
                    alert("아이디를 입력해 주세요");
                }
                else if(pattern_kor.test(signup_mem_id) || pattern_spc.test(signup_mem_id) || signup_mem_id.length < 6)
                {
                    alert("아이디는 6자 이상 영문소문자/숫자로 입력해주세요.");
                }
                else if(!signup_mem_pw)
                {
                    alert("비밀번호를 입력해 주세요");
                }
                else if(pattern_kor.test(signup_mem_pw) || pattern_spc.test(signup_mem_pw) || signup_mem_id.length < 6)
                {
                    alert("비밀번호는 6자 이상 영문소문자/숫자로 입력해주세요.");
                }
                else if(!signup_mem_name)
                {
                    alert("이름을 입력해 주세요");
                }
                else if(pattern_spc.test(signup_mem_name) || pattern_num.test(signup_mem_name))
                {
                    alert("올바른 이름을 입력해 주세요.");
                }
                else if(!signup_mem_phone1 || !signup_mem_phone2)
                {
                    alert("올바른 전화번호를 입력해 주세요");
                }
                else
                {
                    $.post('/signup', 
                    { 
                        id : signup_mem_id, 
                        pw : signup_mem_pw,
                        name : signup_mem_name,
                        phone : signup_mem_phone + signup_mem_phone1 + signup_mem_phone2
                    },
                    function (data) {
                        if(data == false) // 반환값이 없을 경우 아이디 또는 비밀번호가 틀림
                        {
                            alert("동일한 아이디가 이미 존재합니다.");
                        }
                        else // 반환 값이 있을 경우 로그인 성공
                        {
                            alert("회원가입에 성공 했습니다!");
                            $('.mainPage').show();
                            $('.adminPage').hide();
                            $('.loginPage').hide();
                            $('.signupPage').hide();
                            
                        }
                    });
                }
                
            };                          
    </script>

    <script type="text/javascript">
        $(function() {
            $("#product_img").on('change', function(){
                readURL(this);
                
            });
        });
        function product_registration()
            {
                var product_name = $('#product_name').val();
                var product_category = $('#product_category').val();
                var product_price = $('#product_price').val();
                var product_img = "image/";
                product_img += $('#product_img').val().replace(/C:\\fakepath\\/i, ''); // fakePath제외하고 이미지 이름만 가져온다.
                var product_info = $('#product_info').val();
               
                

                console.log(product_img);
                $.post('/products', 
                { PRODUCT_NAME : product_name,
                  PRODUCT_CATEGORY : product_category,
                  PRODUCT_PRICE : product_price,
                  PRODUCT_IMG : product_img,
                  PRODUCT_INFO : product_info
                }, function (data) {
                    if(data == false) // 반환값이 없을 경우 아이디 또는 비밀번호가 틀림
                    {
                        alert("상품 등록에 실패했습니다.");
                    }
                    else // 반환 값이 있을 경우 상품 등록 성공
                    {
                        alert("상품을 등록했습니다!");  
                    }
                });
            }
            
        function readURL(input) // 이미지 미리보기 함수
        {
            if (input.files && input.files[0]) 
            {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#img_preview').attr('src', e.target.result);
                    var file = new file(e.target.result,"image.jpg");
                }

              reader.readAsDataURL(input.files[0]);
            }
        }
        function sessionOver()
        {
            sessionStorage.clear();
            location.reload();
            isLogin = false;
        }
        $(document).ready(function() 
            {
                if(sessionStorage.getItem('userid') != null)
                {
                    $('#loginPageBtn').replaceWith("<a href='#' onclick='sessionOver();'><strong>LOGOUT</strong></a>");
                    
                }
                else
                {
                    $('#loginPageBtn').text("LOGIN");
                }
                if(sessionStorage.getItem('username') == "관리자")
                {
                    $('#adminPageBtn').text("ADMIN");
                }
                
                // 화면 전환 처리 부분
                $('.mainPage').show();
                $('.adminPage').hide();
                $('.loginPage').hide();
                $('.signupPage').hide();
                $('.cartListPage').hide();
                
                
                $('.adminPageBtn').click(function()
                {
                    $('.mainPage').hide();
                    $('.adminPage').show();
                    $('.loginPage').hide();
                    $('.signupPage').hide();
                    $('.cartListPage').hide();
                    $('.orderlist').show();
                    $('.add_product').hide();
                    $('.delete_update_product').hide();
                    $('.orderlist_btn').click(function()
                    {
                        $('.orderlist').show();
                        $('.add_product').hide();
                        $('.delete_update_product').hide();
                        
                    })
                    $('.add_btn').click(function()
                    {
                        $('.orderlist').hide();
                        $('.add_product').show();
                        $('.delete_update_product').hide();
                        
                    })
                    $('.delete_update_btn').click(function()
                    {
                        $('.orderlist').hide();
                        $('.add_product').hide();
                        $('.delete_update_product').show();
                        delete_update_show();
                    })
                   
                })
                $('.loginPageBtn').click(function()
                {
                    $('.mainPage').hide();
                    $('.adminPage').hide();
                    $('.loginPage').show();
                    $('.signupPage').hide();
                    $('.cartListPage').hide();
                })
                $('.cartPageBtn').click(function()
                {
                    if(sessionStorage.getItem('userid'))
                    {
                        $('.mainPage').hide();
                        $('.adminPage').hide();
                        $('.loginPage').hide();
                        $('.signupPage').hide();
                        $('.cartListPage').show();
                        cart_show();
                    }
                    else
                    {
                        alert("로그인 후에 이용가능 합니다.");
                    }
                    
                })
                $('.signupPageBtn').click(function()
                {
                    $('.mainPage').hide();
                    $('.adminPage').hide();
                    $('.loginPage').hide();
                    $('.signupPage').show();
                    $('.cartListPage').hide();
                })  

                showData();  
            });
//          화면에 상품을 보여주는 코드
            

            function delete_update_show()
                {
                    $('.delete_update_product_list').empty();
                    $.getJSON('/products', function (data) 
                        {
                        $(data).each(function (index, item) 
                            {
                                var output = '';
                                output += "<tr> <td scope='row'>" + item.PRODUCT_NUMBER + "</td>";
                                output += "<td scope='row'>" + item.PRODUCT_NAME + "</td> ";
                                output += "<td scope='row'>" + item.PRODUCT_CATEGORY + "</td> ";
                                output += "<td scope='row'>" + item.PRODUCT_PRICE + "</td> ";
                                output += "<td scope='row'><img src=" + item.PRODUCT_IMG + "></td> ";
                                output += "<td scope='row'>" + item.PRODUCT_INFO + "</td> ";
                                output += "<td scope='row'>";
                                deletetext = "/delete/" + item.PRODUCT_NUMBER;
                                output += "<a href=" + deletetext + "> 삭제하기 </a><br><br>";
                                updatetext = "/update/" + item.PRODUCT_NUMBER;
                                output += "<a href=" + updatetext + "> 수정하기 </a></td></tr>";
                                $('.delete_update_product_list').append(output);
                            });   
                        });
            }

            function cart_show()
                {
                    $('.cart_list').empty();
                    console.log("cartshow 실행");
                    cartshowurl = '/addtocart/' + sessionStorage.getItem('userid');
                    var totalprice = 0;
                    $.getJSON(cartshowurl, function (data) 
                        {
                        $(data).each(function (index, item) 
                            {
                                console.log(cartshowurl);
                                var output = '';

                                output += "<tr> <td scope='row'>" + item.order_number + "</td>";
                                output += "<td scope='row'>" + item.product_number + "</td> ";
                                output += "<td scope='row'>" + item.product_name + "</td> ";
                                output += "<td scope='row'><img src=" + item.product_img + "></td> ";
                                output += "<td scope='row'>" + item.product_price + "</td> ";
                                output += "<td scope='row'><input id='productcount' type='number' min='0' max='99' value=" + item.product_count + " ></td>";
                                totalprice += item.product_price * item.product_count;
                                    
                                $('.cart_list').append(output);

                            var totalpricetext = "상품 총 가격 :" + totalprice + " 원";
                            $('#totalprice').append(totalpricetext);
                        });
                        $('#orderbtn').click(function()
                                    {
                                        alert("상품을 주문했습니다");
                                    });
                            });  
                        
            }
            
            function showData()
                {
                    $('.product_list').empty();
                    
                    $.getJSON('/products', function (data) 
                        {
                        $(data).each(function (index, item) 
                            {
                                
                                var output = '';
                                var number = item.PRODUCT_NUMBER;
                                
                                output += "<li id=productNo_" + item.PRODUCT_NUMBER + ">"
                                output += "<div class='thumbnail'> <a href="
                                output += "addtocart/" + item.PRODUCT_NUMBER + ">"
                                output += "<img src=" + item.PRODUCT_IMG + "></a><br>"
                                output += "<a href='#' id=cartimage_" + item.PRODUCT_NUMBER + "><img src='image/cart.jpg' style='width:30px; height: 30px;'></a>"
                                output += "</div>"
                                output += "<div class='description'>"
                                output += "<strong class=''> " + item.PRODUCT_NAME + "</strong>"
                
                                output += "<br>" + item.PRODUCT_PRICE + "원" 
                                output += "</div>"
                                output +=" </li>"
                                //alert(output);
                                $('.product_list').append(output);
                                $('#cartimage_' + item.PRODUCT_NUMBER).click(function(){
                                    if (confirm('장바구니에 상품을 추가하시겠습니까?')) {
                                                if(sessionStorage.getItem("userid"))
                                                {
                                                    
                                                    $.post('/addtocart', 
                                                        { 
                                                        ORDER_ID : sessionStorage.getItem('userid'),
                                                        PRODUCT_NUMBER : item.PRODUCT_NUMBER,
                                                        PRODUCT_NAME : item.PRODUCT_NAME,
                                                        PRODUCT_PRICE : item.PRODUCT_PRICE,
                                                        PRODUCT_COUNT : '1',
                                                        PRODUCT_IMG : item.PRODUCT_IMG
                                                        }, function (data) {
                                                            if(data == false) // 반환값이 없을 경우 아이디 또는 비밀번호가 틀림
                                                            {
                                                                console.log("db에 addtocart 실패");
                                                            }
                                                            else // 반환 값이 있을 경우 상품 등록 성공
                                                            {
                                                                console.log("db에 addtocart 성공");
                                                            }
                                                        });

                                                    alert("상품을 추가 했습니다.!");
                                                    
                                                }
                                                else
                                                {
                                                    alert("로그인 후에 이용 가능합니다.");
                                                }
                                        } else {
                                            
                                            // no click
                                    }
                                })
                            });   
                        });
            }
            
            
        </script>

    </head>
    
    <!---------------------------------------------------------------- 의류 메뉴 div ------------------------------------------------------>
    <div style="height: 100%; width: 18%; padding-left: 30px; background-color: #D8D8D8; float: left; " ><a href="index.html"><img src="HWS_logo.png"  style="width: 90%; padding-top: 30px;"></a>
        <br><br><br><br>
            <ul id="navi"> <!-- UnOrdered List 순서가 없는 목록 요소 -->
                <li class="group"> <!-- 내부에 들어갈 자식 요소 -->
                    <div class="title">OUTER</div> <!-- 클래스 지정으로 스타일 시트 사용하기 -->
                    <ul class="sub">
                        <li><a href="#">JACKET</a></li>
                        <li><a href="#">COAT</a></li>
                        <li><a href="#">VEST</a></li>
                    </ul>
                </li>
                <li class="group">
                    <div class="title">TEE</div>
                    <ul class="sub">
                        <li><a href="#">SHIRT</a></li>                
                    </ul>
                </li>
                <li class="group">
                    <div class="title">ACC</div>
                    <ul class="sub">
                        <li><a href="#">CAP</a></li>
                        <li><a href="#">ACCESSORY</a></li>
                    </ul>
                </li>        
            </ul>
    </div>
    <!---------------------------------------------------------------- 상단 메뉴 div ------------------------------------------------------>
    <div class="topmenudiv"style="height: 6%; border-style: outset; border-width: 1px;"> 
        <br>
            
            <a  href="#none" class="loginPageBtn" id="loginPageBtn"><strong >LOGIN</strong></a>
            <a  href="#none" class="signupPageBtn" ><strong>JOIN</strong></a>
            <a  href="#none" class="cartPageBtn" ><strong>CART</strong></a>
            <a  href="#none" class="adminPageBtn" id="adminPageBtn" ><strong></strong></a>
        </div>
        <!--------------------------------------------------------- 메인 페이지 div ------------------------------------------------------------>
        <div id="contents" class="mainPage">
            <div id="best_products" style=" height: 70px;">
                <h2 style="font-family: sans-serif; text-align: center; padding-top: 20px;">BEST OF BEST</h2>
            </div>
            <ul class="product_list">
            </ul>
        </div>
        <!--------------------------------------------------------- 장바구니 페이지 ------------------------------------------------------------>
        <div id="contents" class="cartListPage" style="padding: 10px;">
            <table border="1">
                <thead><h2 style="text-align: center;">장바구니</h2>
                    <tr>
                            <th scope="cols">주문 번호</th>
                            <th scope="cols">상품 번호</th>
                            <th scope="cols">상품 이름</th>
                            <th scope="cols">상품 이미지</th>
                            <th scope="cols">상품 가격</th>  
                            <th scope="cols">상품 수량</th>  
                    </tr>
                    
                </thead>
                <tbody class="cart_list">

                </tbody>
            </table>
            <div style="text-align: right; padding: 30px;">
                <h3 id="totalprice"></h3>
                <a  href="#"><img id="orderbtn" src="btn_order.gif"></a>
                
            </div>
    </div>
        <!---------------------------------------------------------------- 관리자 데이터 삽입 div ------------------------------------------------------>
        <div id="contents" class="adminPage" > 
            <div class="admin_menu" style="text-align: center; padding: 30px;">
                <a href="#" class="orderlist_btn" >주문현황</a>
                <a href="#" class="add_btn" >상품 추가하기</a>
                <a href="#" class="delete_update_btn">상품 삭제,수정 하기</a>
            </div>
            <div class="orderlist">

            </div>
            <div class="delete_update_product">
                    <table border="1">
                        <thead>
                            <tr>
                                    <th scope="cols">상품번호</th>
                                    <th scope="cols">상품이름</th>
                                    <th scope="cols">상품카테고리</th>
                                    <th scope="cols">상품가격</th>
                                    <th scope="cols">상품이미지</th>
                                    <th scope="cols">상품설명</th>  
                                    <th scope="cols">수정, 삭제</th>  
                            </tr>
                            
                        </thead>
                        <tbody class="delete_update_product_list">

                        </tbody>
                    </table>
            </div>
                <div class="add_product">
                <table border="1">

                        <tbody>
                        <tr>
                        <th scope="row">상품명 </th>
                                        <td>
                                            <input type="text" id="product_name" s>
                                        </td>
                                    </tr>
                        <tr>
                        <th scope="row">카테고리</th>
                                        <td> 
                                        <select id="product_category">
                                        <option value="">카테고리 선택</option>
                                        <option value="JACKET">JACKET</option>
                                        <option value="COAT">COAT</option>
                                        <option value="VEST">VEST</option>
                                        <option value="SHIRT">SHIRT</option>
                                        <option value="CAP">CAP</option>
                                        <option value="ACCESSORY">ACCESSORY</option>
                                    </select>
                                    </td>
                                    </tr>
                        <tr>
                        <th scope="row">상품 가격 </th>
                                        <td><input type="text" id="product_price"></td>
                                    </tr>
        
                                    </tr>
                        <tr class="displaynone">
                        <th scope="row">상품 이미지 </th>
                                        <td><input id="product_img" type="file" accept=".gif, .jpg, .png" />
                                    </td>            
                                    </tr>
                        <th scope="row">상품 이미지<br>미리보기</th>
                            <td><img id="img_preview" width="300px" height="370px">
                                </td>            
                                </tr>
                        <tr >
                            <th scope="row">상품 상세설명</th>
                            <td><textarea id="product_info" style="width: 99%; height: 500px; resize: none;" ></textarea></td>
                            </tr>
                        </tbody>
                       
                        </table>
                        <div style=" padding: 20px; text-align: center;">
                            <a href="#" onclick="product_registration()"><img src="btn_product_regist.gif">
                            </a>
                        </div>
                        </div>

        </div>

        <!---------------------------------------------------------------- 로그인 화면 div ------------------------------------------------------>
        <div id="contents" class="loginPage" > 
        <table border="1">
            <caption style="padding: 30px;"><h2>로그인</h2></caption>
            <tbody>
                <tr>
                    <th>아이디</th>
                    <td> <input id="member_id" type="text" size="15"></td>
                </tr>
                <tr>
                    <th>비밀번호</th>
                    <td> <input id="member_password" type="password" size="15"></td>
                </tr>
            </tbody>
        </table>
        <div style=" padding: 20px; text-align: center;"><a href="#" onclick="loginfunction()"><img src="btn_member_login.gif"></a></div>
        
        </div>
        <!---------------------------------------------------------------- 회원 가입 div ------------------------------------------------------>
        <div id="contents" class="signupPage">
              
                        <table border="1">
                <caption style="padding: 30px;"><h2 style="font-family: sans-serif;">회원가입</h2></caption>

                <tbody>
                <tr>
                <th>아이디 </th>
                    <td>
                        <input id="signup_member_id" type="text" size="15"> 
                    </td>
                </tr>

                <tr>
                <th>비밀번호 </th>
                    <td><input id="signup_member_pw" type="password" size="15"> </td>
                </tr>
                
               
                <tr>
                    <th>이름 </th>
                        <td>
                            <input id="signup_member_name" type="text" size="15"> 
                        </td>
                </tr>

                <tr>
                <th>휴대전화 </th>
                    <td ><select id="signup_member_phone">
                        <option value="010">010</option>
                        <option value="011">011</option>
                        <option value="016">016</option>
                        <option value="017">017</option>
                        <option value="018">018</option>
                        <option value="019">019</option>
                    </select>
                - <input id="signup_member_phone1" maxlength="4" onKeyup="this.value=this.value.replace(/[^0-9]/g,'');" type="text" size="4">
                - <input id="signup_member_phone2" maxlength="4" onKeyup="this.value=this.value.replace(/[^0-9]/g,'');" type="text" size="4">
                    </td>
                </tr> 
            </tbody>
        </table>
        <div style=" padding: 20px; text-align: center;"><a href="#" onclick="signupfunction()"><img src="btn_member_join1.gif"></a></div>
        
    </div>
    
</html>